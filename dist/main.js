(()=>{"use strict";function t(t=8){let e={};return e.dim=t,e.ships=[],e.occupied=[],e.misses=[],e.hits=[],e.placeShip=function(t,i,r){let o=t(i,r);(function(t,e){let i=JSON.stringify(t.occupied);for(let r=0;r<e.length;r++){let o=e[r];if(o[0]>=t.dim||o[1]>=t.dim)return!1;if(-1!=i.indexOf(o))return!1}return!0})(e,o.position)&&(e.occupied=e.occupied.concat(o.position),e.ships.push(o))},e.receiveAttack=function(t){if(function(t,e){return-1==JSON.stringify(t.occupied).indexOf(e)}(e,t)&&e.misses.push(t),function(t,e){return-1==JSON.stringify(t.hits).indexOf(e)}(e,t)){e.hits.push(t);for(let i=0;i<e.ships.length;i++){let r=e.ships[i];for(let e=0;e<r.position.length;e++)JSON.stringify(r.position[e])==JSON.stringify(t)&&r.hit()}}},e.isAllSunk=function(){let t=e.ships;for(let e=0;e<t.length;e++)if(0==t[e].isSunk())return!1;return!0},e}const e=(t,e="Foo")=>{let o={};return o.name=e,o.isComputer=!1,o.board=t(),o.attack=function(t,e){t.receiveAttack(e)},o.attackRandom=function(t){if(o.isComputer){let e=t.hits.length,r=t.dim;for(;t.hits.length==e;)t.receiveAttack(i(r))}},o.setupDisplay=function(t){let e=document.createElement("div");e.classList.add("board"),e.setAttribute("id",o.name);let i=0;for(;i<o.board.dim*o.board.dim;){let t=document.createElement("div");t.classList.add("grid-pos"),t.setAttribute("id",i),e.appendChild(t),i++}o.board.occupied.forEach((t=>{let i=r(o.board.dim,t);e.querySelectorAll(".grid-pos")[i].classList.add("occupied")})),t.appendChild(e)},o.updateDisplay=function(){let t=document.getElementById(o.name);o.board.hits.forEach((e=>{let i=r(o.board.dim,e);t.querySelectorAll(".grid-pos")[i].classList.remove("occupied"),t.querySelectorAll(".grid-pos")[i].classList.add("hit")})),o.board.misses.forEach((e=>{let i=r(o.board.dim,e);t.querySelectorAll(".grid-pos")[i].classList.add("miss")}))},o};function i(t){return[Math.floor(Math.random()*t),Math.floor(Math.random()*t)]}function r(t,e){return e[0]+t*e[1]}const o=(t,e)=>{let i={};i.length=t,i.numOfHits=0,i.position=[];let[r,o]=e;for(let e=0;e<t;e++)i.position.push([r,o]),r+=1;return i.hit=function(){i.numOfHits+=1},i.isSunk=function(){return i.length<=i.numOfHits},i};(function(){let i={};return i.p1=e(t),i.p2=e(t,"Computer"),i.isP1Turn=!0,i.p2.isComputer=!0,i.isOver=function(){return i.p1.board.isAllSunk()||i.p2.board.isAllSunk()},i.setup=function(t){var e,r;e=i.p1,r=i.p2,e.board.placeShip(o,3,[0,0]),e.board.placeShip(o,3,[1,1]),e.board.placeShip(o,4,[2,5]),r.board.placeShip(o,4,[0,0]),r.board.placeShip(o,3,[4,2]),r.board.placeShip(o,3,[2,4]),i.p1.setupDisplay(t),i.p2.setupDisplay(t),t.querySelector(`#${i.p2.name}`).querySelectorAll(".grid-pos").forEach((t=>{t.addEventListener("click",(()=>i.playRound(t.id)))}))},i.playRound=function(t){let e=i.p1,r=i.p2,o=i.p1.board.dim,n=t%o,s=Math.floor(t/o);e.attack(r.board,[n,s]),r.updateDisplay(),i.isOver()||(r.attackRandom(e.board),i.isOver())},i.play=function(){let t=i.p1,e=i.p2;for(;!i.isOver();)i.isP1Turn?(t.attack(e.board,[2,1]),e.updateDisplay(),i.isP1Turn=!1):(e.attackRandom(t.board),t.updateDisplay(),i.isP1Turn=!0)},i})().setup(document.querySelector(".game"))})();